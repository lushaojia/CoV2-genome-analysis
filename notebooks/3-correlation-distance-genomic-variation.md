# Final Project: Analysis 2
## Analysis Question: Does the distance between the location where a SARS-CoV2 sample was collected and Seattle, Washington positively correlate with the extent to which the sample's genomic sequencing differ from that of the earliest reported U.S. COVID-19 case?
> Note: The earliest U.S. COVID-19 case was reported in Seattle, Washington.
In this analysis, it is referred to as the "origin".
* * *
## Goals & Hypothesis:
To run a linear regression on the distance between two sets of data 
1. Distance between the location where a SARS-CoV2 sample was collected (covering all 50 States and including Puerto Rico) and Seattle, Washington 
2. Distance metrics generated from the genomic sequencing of SARS-CoV2 samples scattered across the country and that of the earliest reported U.S. COVID-19 case


and to create a scatterplot of these 51 data pairs and the line of best fit generated from the linear regression.

I hypothesize that given all other factors (e.g. time of sample collection) are controlled, 
SARS-CoV2 samples located farther away from the origin at the time of their collection have a greater number of differences between their genomic sequencing and that of the earliest case. 

Given that variants of SARS-CoV2 have arisen in countries across the globe 
(Variant Alpha from the U.K., Variant Beta from South Africa, Variant Gamma from Brazil, and Variant Delta from India), 
whether a similar phenomenon can be observed at a more micro scale within the United States itself becomes a question of interest.   
* * *
## Methods Overview:
> Note: The difference in two SARS-CoV2 samples' genomic sequencing is crudely measured by a "distance metric". This "distance metric" is an integer between 0 and 1 generated by comparing the unique kmers found in these two sequences. 
The greater number of unique kmers the two sequences have in common, the closer their distance metric is to 0, and the closer related they are; and vice versa.

> Note: The distance between the location where a sample was collected and the origin was determined with the help of [travelmath][1]. All distances are flying distances in miles.

[1]: https://www.travelmath.com/
1. Parse the data

2. Generate the set of unique kmers found in each sequence

3. Generate a distance metric between the sequence from State X, Y, Z,... and the earliest reported U.S. COVID-19 case

4. Determine the distance between the geo location of where a sample was collected and Seattle, Washington

5. Run a linear regression of the data generated in Steps #3 and #4

6. Create a scatterplot with a line of best fit from this data
* * *
### 1. Setting Up
```julia
using BioinformaticsBISC195

parsed_earliest_case = parse_fasta("data/earliest-case-SARS-cov2-genome.fasta")

states_arr = ["AK", "AL", "AR", "AZ", "CA", "CO", "CT", "DE", "FL", "GA", "HI", "IA", "ID", "IL", "IN", "KS", "KY", "LA", "MA", "MD", "ME", "MI", "MN", "MO", "MS", "MT", "NC", "ND", "NE", "NH", "NJ", "NM", "NV", "NY", "OH", "OK", "OR", "PA", "PR", "RI", "SC", "SD", "TN", "TX", "UT", "VA", "VT", "WA", "WI", "WV", "WY"]

begin
    parsed_US_cases = []
    for state in states_arr
        path = "data/" * state * "-SARS-cov2-genome.fasta"
        parsed_state_case = parse_fasta(path)
        push!(parsed_US_cases, parsed_state_case)
    end
end
```
* * *
### 2. Identifying Unique Kmers In Each Sequence
At first, the kmer length was set to 3. This resulted in distance metrics of all 0.0's, so I decided to increase the length of the kmers to 7 to hone in on the sequences' differences.
```julia
# origin
uk_earliest_case = uniqueKmers(parsed_earliest_case[2][1], 7) 

# samples from States and territories across the U.S.
begin
    uk_US_cases = []
    geo_location = []
    for parsed_state_case in parsed_US_cases
        uk_state_case = uniqueKmers(parsed_state_case[2][1], 7)
        header = parsed_state_case[1][1]
        sample_location = split(header, "|")[2][6:end]
        push!(uk_US_cases, uk_state_case)
        @info uk_state_case # for some live feedback on the script's progress
        push!(geo_location, sample_location)
        @info sample_location
    end
end
```
* * *
### 3. Generating Distance Metrics to Compare the Origin Sample with Samples Across the U.S.
The most common method for determining how closely related two sequences are is evaluating their distance metric.

Distance metrics can be generated from sequence alignments, but they can also be generated from comparing the unique kmers in two sequences. 

In the following code block, distance metrics are generated from sequences from the origin case and samples scattered across the U.S. to crudely compare how closely related they are in terms of genetic composition.
```julia
begin
    kd_US_cases = Float64[]
    for uk_state_case in uk_US_cases
        kd_state_case = compareKmerSets(uk_earliest_case, uk_state_case)
        push!(kd_US_cases, kd_state_case)
    end
end
```
***
### 4. Determining the Distance Between the Geo Location of Where a Sample Was Collected and the Origin

```julia
# An Array of the distance between the geo location of samples across the U.S. and Seattle, WA
# Corresponds with the States stored in geo_location; arranged in the same order
distance_from_Seattle_WA = [1438, 2082, 1771, 1112, 800, 1037, 2438, 2383, 2568, 2248, 2677, 1473, 443, 1721, 1864, 1428, 2016, 2097, 2474, 2333, 2502, 1840, 1350, 1634, 1987, 566, 2316, 1050, 1266, 2438, 2398, 1212, 686, 2408, 2010, 1547, 210, 2261, 3719, 2493, 2339, 1121, 1993, 1731, 735, 2313, 2368, 39, 1581, 2159, 810]
```
* * *
### 5. Correlation Between Geo Location Distance and Kmer Set (Dis)similarity
Now that the distance metrics and the distance between geo locations of samples have been determined, it is time to see 
whether the two **positively correlate / negatively correlate / do not correlate** 
with each other. 

We shall accomplish this by building a linear regression model.

```julia
using DataFrames
df = DataFrame(X = distance_from_Seattle_WA, Y = kd_US_cases)

using GLM
lm(@formula(Y ~ X), df)
```
Statistic table generated from the linear regression:
|       | Coef. | Std. Error | t | Pr(>\|t\|) | Lower 95% | Upper 95% |
| ----------- | ----------- | ----------- | ----------- | ----------- | ----------- | ----------- |
| (Intercept)     |   0.0094108   | 0.000550844 |17.08|<1e-21|0.00830384|0.0105178|
| X  |  3.64063e-7    | 2.89729e-7|1.26|0.2149|-2.1817e-7|9.46295e-7|

Looking at the statistic table above, we know that the probability of arriving at a
result as "extreme" as this one (i.e. a t-value as large as the one above) in a
collection of random data points where there is no correlation between the independent and
dependent variables is approximately 21.5%. While this does not reach the 0.05 value at 
which the null hypothesis (that there is no correlation) is typically rejected, it still shows that *some* correlation exists between
the <sup>1</sup>independent and <sup>2</sup>dependent variables, which in this case are <sup>1</sup>the
distance between the geo location of where a sample was collected and the origin, and <sup>2</sup>the
extent to which these samples differ genetically from each other.

* * *
### 6. Scatterplot
Looking at the scatterplot below, we can see that there exists a faint, positive correlation between the independent and dependent variables, 
as the individual data points fluctuate drastically above and below the line of best fit. 

The lack of uniformity in the individual data points' distribution across the graph further confirms my analyses of the p-value from above: while a linear model with a slight positive slope could explain the data at hand, it may not be the best one.

I did not explicitly calculate this, but I predict that the sum of squared residuals is relatively large as most data points are quite some vertical distance away from the line of best which. This would further indicate that the proposed model does not explain the data exceptionally well.
 
On the other hand, the linear model's positive slop of 3.64063e-7 indicates that 
there is *some* positive correlation between the variables despite the fact that it may not be statistically significant.  
```julia
using Plots
x = distance_from_Seattle_WA
y = kd_US_cases
f(x) = 3.64063e-7x + 0.0094108
scatterplot = plot(x, y, seriestype = :scatter,
    xlabel = "Distance Between Sample Location and Seattle, WA\n(Miles)",
    ylabel = "Kmer Sets Distance Metric",
    title = "Correlation Between Sample Distance From \nSeattle, WA and SARS-CoV2 Genomic Variance",
    label = "")
plot!(f, label = "Line of Best Fit")
```
* * *
### Conclusion
Briefly put, the above analyses suggest that there is a faint, positive correlation between the distance from the location of where a SARS-CoV2 sample was collected to the origin and the extent to which the SARS-CoV2 from the samples differ genetically. In other words, the farther away from the origin a sample is at the time of its collection, the more different it is genetically from the SARS-CoV2 that started the outbreak in the U.S.




